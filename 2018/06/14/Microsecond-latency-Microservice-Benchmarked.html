<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Microsecond latency Microservice Benchmarked</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://vanilla-java.github.io/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:400,700,400italic,700italic|Open+Sans:400italic,700italic,700,400">
    <link rel="stylesheet" type="text/css" href="//vanilla-java.github.io/themes/roon/assets/css/screen.css?v=1536077091929" />

    <link rel="canonical" href="https://vanilla-java.github.io/2018/06/14/Microsecond-latency-Microservice-Benchmarked.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Vanilla Java" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Microsecond latency Microservice Benchmarked" />
    <meta property="og:description" content="It is common for a vendor to publish benchmarks with synthetic loads and code.  However, what can be reasonably achieve in a real application?  In this post, I discuss what we achieve with Chronicle Services for a client&amp;#8217;s use case, a framework for low latency microservices. What are" />
    <meta property="og:url" content="https://vanilla-java.github.io/2018/06/14/Microsecond-latency-Microservice-Benchmarked.html" />
    <meta property="article:published_time" content="2018-06-14T00:00:00.000Z" />
    <meta property="article:tag" content="Low Latency" />
    <meta property="article:tag" content="Microservices" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Microsecond latency Microservice Benchmarked" />
    <meta name="twitter:description" content="It is common for a vendor to publish benchmarks with synthetic loads and code.  However, what can be reasonably achieve in a real application?  In this post, I discuss what we achieve with Chronicle Services for a client&amp;#8217;s use case, a framework for low latency microservices. What are" />
    <meta name="twitter:url" content="https://vanilla-java.github.io/2018/06/14/Microsecond-latency-Microservice-Benchmarked.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Vanilla Java",
    "author": {
        "@type": "Person",
        "name": "Peter Lawrey",
        "image": "https://avatars0.githubusercontent.com/u/1070321?v=4",
        "url": "https://vanilla-java.github.io/author/peter-lawrey/",
        "sameAs": "http://vanillajava.blogspot.com/",
        "description": "Most answers for Java and JVM on StackOverflow.com (~13K), &quot;Vanilla Java&quot; blog with four million views, founder of the Performance JUG,  Java Champion"
    },
    "headline": "Microsecond latency Microservice Benchmarked",
    "url": "https://vanilla-java.github.io/2018/06/14/Microsecond-latency-Microservice-Benchmarked.html",
    "datePublished": "2018-06-14T00:00:00.000Z",
    "keywords": "Low Latency, Microservices",
    "description": "It is common for a vendor to publish benchmarks with synthetic loads and code.  However, what can be reasonably achieve in a real application?  In this post, I discuss what we achieve with Chronicle Services for a client&amp;#8217;s use case, a framework for low latency microservices. What are"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Vanilla Java" href="https://vanilla-java.github.io/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/themes/prism-okaidia.min.css">
    
        <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
</head>
<body class="post-template tag-Low-Latency tag-Microservices  noimage">

    


    <article role="main" class="">
        <header>
            <a href="https://vanilla-java.github.io" id="home_link">Â«</a>
            <div class="meta"><time datetime="2018-06-14"><a href="https://vanilla-java.github.io/2018/06/14/Microsecond-latency-Microservice-Benchmarked.html">June 14, 2018</a></time> <span class="count" id="js-reading-time"></span></div>
            <h1>Microsecond latency Microservice Benchmarked</h1>
        </header>

        <div class="text" id="js-post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>It is common for a vendor to publish benchmarks with synthetic loads and code.  However, what can be reasonably achieve in a real application?  In this post, I discuss what we achieve with Chronicle Services for a client&#8217;s use case, a framework for low latency microservices.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_are_we_benchmarking">What are we benchmarking?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Chronicle Services we favour a high level interface where a publisher makes a method call, and the consumer is called back on the same method. This is slower than more direct access approaches but easier to maintain, esp for Java developers who want to develop in natural Java.</p>
</div>
<div class="listingblock">
<div class="title">Microservice interface</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface NewOrderSingleListener {
    void newOrderSingle(NewOrderSingle newOrderSingle);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A simple interface for messages in and a simple interface for messages out makes writing mocking services, creating data driven and integration tests natural and simple.</p>
</div>
<div class="paragraph">
<p>When used in the framework, every message is persisted in a logged/replayable manner and the publisher and consumer can be different JVMs or even different machines.</p>
</div>
<div class="paragraph">
<p>In this performance test, we include the time to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mock the interface</p>
</li>
<li>
<p>serialize the NewOrderSingle with 28 FIX fields, including String(s).</p>
</li>
<li>
<p>write to shared memory</p>
</li>
<li>
<p>read from shared memory in another microservice</p>
</li>
<li>
<p>deserialize a NewOrderSingle</p>
</li>
<li>
<p>make a method call to the component in the service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A significant portion of the time spent is in string handling.  The class for NewOrderSingle was generated for the FIX protocol schema using <a href="https://chronicle.software/products/fix/">Chronicle FIX</a></p>
</div>
<div class="paragraph">
<p>The test was run for 10,000,000 orders at a rate of 10,000 per second on a dual CPU E5-2650 v4 @ 2.20GHz server running Centos 7.  Each service was single threaded. Higher throughputs can be achieved by adding more threads, or with poorer latency profiles i.e the 99.9% is higher.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://vanilla-java.github.io/images/NOS-latency.png" alt="NOS latency">
</div>
</div>
<div class="paragraph">
<p>The worst latency was 9.7 ms.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this test, no minor or major GCs were triggered.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_what_about_co_ordinated_ommission">What about co-ordinated ommission?</h3>
<div class="paragraph">
<p>For more information on what is co-ordinated ommission <a href="https://www.infoq.com/presentations/latency-pitfalls">How NOT to measure latency</a> by Gil Tene.</p>
</div>
<div class="paragraph">
<p>In our case, it doesn&#8217;t show in these results as we</p>
</div>
<div class="ulist">
<ul>
<li>
<p>have a low throughput compared with latency. The messages are 100 micro-seconds apart but typically have pass each message in around 1 micro-second.</p>
</li>
<li>
<p>in higher percentiles, it&#8217;s factor however they are not included here as they are very hard to reproduce from one system to another (OS/filesystem/CPU/Vendor/Java version). Even power settings and temperature are factors.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In short, for the region of the chart shown, co-ordinated ommission isn&#8217;t a factor.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_does_this_compare_to_other_messaging_solutions">How does this compare to other messaging solutions?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is hard to find comparable benchmark results on the latency of messaging solutions.  One good option might be to use a benchmark like <a href="https://github.com/openmessaging/openmessaging-benchmark" class="bare">https://github.com/openmessaging/openmessaging-benchmark</a> although this doesn&#8217;t consider the serialization cost which can be relatively high, esp in Java if it triggers GCs. I couldn&#8217;t find any published benchmark results other than to say that Pulsar was faster than Kafka.</p>
</div>
<div class="paragraph">
<p>Most messaging solutions do not include the cost of serialization which can be higher than the cost of messaging.  Some only consider the time to publish or consume a message.  It is important to choose a benchmark which is representative of your use case.</p>
</div>
<div class="paragraph">
<p>Many messaging tests only consider throughput, or message latencies in milli-seconds.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_much_is_open_source">How much is open source?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A good place to start is the <a href="https://github.com/OpenHFT/Chronicle-Queue" class="bare">https://github.com/OpenHFT/Chronicle-Queue</a> which has 1.4k stars and is a key library in building micro services.</p>
</div>
<div class="paragraph">
<p>If you are intrested in our low latency micro services framework which supports distribution and data driven testing of these micro-services contact <a href="mailto:sales@chronicle.software">sales@chronicle.software</a></p>
</div>
</div>
</div>
        </div>

        <menu>
            <a href="" id="btn_share" class="btn" title="Share">
                <span aria-hidden="true" data-icon="S"></span>
                <strong>Share</strong>
            </a>
            <a href="http://twitter.com/share?text=Microsecond%20latency%20Microservice%20Benchmarked&url=https://vanilla-java.github.io/2018/06/14/Microsecond-latency-Microservice-Benchmarked.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" id="btn_comment" class="btn" target="_blank">
                <span aria-hidden="true" data-icon="C"></span> Comment on Twitter
            </a>
        </menu>


        <footer class="post-footer" role="contentinfo">

            <div class="vcard">
                <a href="https://vanilla-java.github.io/rss" id="btn_feed" class="btn" title="Feed" target="_blank">
                    <span aria-hidden="true" data-icon=")"></span>
                    <strong>Feed</strong>
                </a>

                <a href="https://vanilla-java.github.io/author/peter-lawrey/" class="photo">
                    <span style="background-image: url('https://avatars0.githubusercontent.com/u/1070321?v&#x3D;4');">
                        <img src="https://avatars0.githubusercontent.com/u/1070321?v&#x3D;4" alt="Peter Lawrey">
                    </span>
                </a>

                <div class="details">
                    <h4><a href="https://vanilla-java.github.io/author/peter-lawrey/" class="url n">Peter Lawrey</a></h4>
                    London<br>
                    <a href="http://vanillajava.blogspot.com/" class="js-remove-domain-schema">http://vanillajava.blogspot.com/</a>
                </div>
            </div>

            <div id="user_bio">
                <div class="inner">
                    Most answers for Java and JVM on StackOverflow.com (~13K), &quot;Vanilla Java&quot; blog with four million views, founder of the Performance JUG,  Java Champion
                </div>
            </div>

        </footer>




    <section class="post-comments">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
      var disqus_shortname = 'vanillajava'; // required: replace example with your forum shortname
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </section>


    </article>

    <div id="share_modal">
        <div class="wrap">
            <div class="inner">
                <header>
                    Share
                    <a href="" class="close" title="Close">&times;</a>
                </header>

                <div class="roon-share-links">
                    <a href="https://twitter.com/share" class="twitter-share-button" data-dnt="true">Tweet</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

                    <div id="fb-elems">
                        <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                        var js, fjs = d.getElementsByTagName(s)[0];
                        if (d.getElementById(id)) return;
                        js = d.createElement(s); js.id = id;
                        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=463438580397968";
                        fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));</script>
                        <div class="fb-like" data-send="false" data-layout="button_count" data-width="110" data-show-faces="false" data-font="arial"></div>
                    </div>

                    <div id="pinit-btn">
                        <a href="//pinterest.com/pin/create/button/?url=https://vanilla-java.github.io/2018/06/14/Microsecond-latency-Microservice-Benchmarked.html&amp;description=Microsecond%20latency%20Microservice%20Benchmarked-Vanilla%20Java " data-pin-do="buttonPin" data-pin-config="beside"><img src="//assets.pinterest.com/images/pidgets/pin_it_button.png"></a>
                        <script type="text/javascript" src="//assets.pinterest.com/js/pinit.js"></script>
                    </div>
                </div>
            </div>
        </div>
    </div>




        <a href="https://vanilla-java.github.io" id="blog_badge">
            <span style="background-image: url('https://raw.githubusercontent.com/Vanilla-Java/vanilla-java.github.io/master/images/French-Vanilla-Java.jpg');">Vanilla Java</span>
        </a>


    <script>

            function get_text(el) {
                ret = "";
                var length = el.childNodes.length;
                for(var i = 0; i < length; i++) {
                    var node = el.childNodes[i];
                    if(node.nodeType != 8) {
                        ret += node.nodeType != 1 ? node.nodeValue : get_text(node);
                    }
                }
                return ret;
            }
            function reading_time () {
                var post_content = document.getElementById('js-post-content');
                if (post_content) {
                    var words = get_text(post_content),
                        count = words.split(/\s+/).length,
                        read_time = Math.ceil((count / 150)),
                        read_time_node = document.createTextNode(read_time + ' min read');
                    document.getElementById('js-reading-time').appendChild(read_time_node);
                }
            }

        function no_schema_links () {
            var links = document.querySelectorAll('.js-remove-domain-schema');
            if (links) {
                for (i = 0; i < links.length; ++i) {
                    var link = links[i],
                        text = link.innerHTML,
                        no_schema = text.replace(/.*?:\/\//g, "");
                    link.innerHTML = no_schema;
                }
            }
        }

        window.onload = function () {
            no_schema_links();

            reading_time();
        }
    </script>


    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/prism.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        // hljs.initHighlightingOnLoad();
      </script>

        <script>
            $(function(){
                var share_modal = $("#share_modal"),
                    update_social_links = true;

                $("#btn_share").click(function(){
                    var that = $(this);
                    share_modal.fadeIn(200);
                    return false;
                });

                share_modal.click(function(e){
                    if (e.target.className == "wrap" || e.target.id == "share_modal") {
                        share_modal.fadeOut(200);
                    }
                    return false;
                });

                share_modal.find("div.inner > header > a.close").click(function(){
                    share_modal.fadeOut(200);
                    return false;
                });
            });
        </script>


    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-81039510-1', 'auto');
    ga('send', 'pageview');

    </script>

</body>
</html>
