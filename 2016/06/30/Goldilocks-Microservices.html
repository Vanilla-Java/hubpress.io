<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Goldilocks Microservices</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://vanilla-java.github.io/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:400,700,400italic,700italic|Open+Sans:400italic,700italic,700,400">
    <link rel="stylesheet" type="text/css" href="//vanilla-java.github.io/themes/roon/assets/css/screen.css?v=1536077092583" />

    <link rel="canonical" href="https://vanilla-java.github.io/2016/06/30/Goldilocks-Microservices.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Vanilla Java" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Goldilocks Microservices" />
    <meta property="og:description" content="How to structure microservices? When structuring microservices we have to consider; how fine grain should our components be? how distributed should they be? I believe it&amp;#8217;s important to treat these as separate concerns, even to the extent of ensuring your business logic components are not dependant on the" />
    <meta property="og:url" content="https://vanilla-java.github.io/2016/06/30/Goldilocks-Microservices.html" />
    <meta property="article:published_time" content="2016-06-30T00:00:00.000Z" />
    <meta property="article:tag" content="Microservices" />
    <meta property="article:tag" content="Right Sizing" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Goldilocks Microservices" />
    <meta name="twitter:description" content="How to structure microservices? When structuring microservices we have to consider; how fine grain should our components be? how distributed should they be? I believe it&amp;#8217;s important to treat these as separate concerns, even to the extent of ensuring your business logic components are not dependant on the" />
    <meta name="twitter:url" content="https://vanilla-java.github.io/2016/06/30/Goldilocks-Microservices.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Vanilla Java",
    "author": {
        "@type": "Person",
        "name": "Peter Lawrey",
        "image": "https://avatars0.githubusercontent.com/u/1070321?v=4",
        "url": "https://vanilla-java.github.io/author/peter-lawrey/",
        "sameAs": "http://vanillajava.blogspot.com/",
        "description": "Most answers for Java and JVM on StackOverflow.com (~13K), &quot;Vanilla Java&quot; blog with four million views, founder of the Performance JUG,  Java Champion"
    },
    "headline": "Goldilocks Microservices",
    "url": "https://vanilla-java.github.io/2016/06/30/Goldilocks-Microservices.html",
    "datePublished": "2016-06-30T00:00:00.000Z",
    "keywords": "Microservices, Right Sizing",
    "description": "How to structure microservices? When structuring microservices we have to consider; how fine grain should our components be? how distributed should they be? I believe it&amp;#8217;s important to treat these as separate concerns, even to the extent of ensuring your business logic components are not dependant on the"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Vanilla Java" href="https://vanilla-java.github.io/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/themes/prism-okaidia.min.css">
    
        <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
</head>
<body class="post-template tag-Microservices tag-Right-Sizing  noimage">

    


    <article role="main" class="">
        <header>
            <a href="https://vanilla-java.github.io" id="home_link">Â«</a>
            <div class="meta"><time datetime="2016-06-30"><a href="/">June 30, 2016</a></time> <span class="count" id="js-reading-time"></span></div>
            <h1>Goldilocks Microservices</h1>
        </header>

        <div class="text" id="js-post-content">
            <div class="sect2">
<h3 id="_how_to_structure_microservices">How to structure microservices?</h3>
<div class="paragraph">
<p>When structuring microservices we have to consider;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>how fine grain should our components be?</p>
</li>
<li>
<p>how distributed should they be?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I believe it&#8217;s important to treat these as separate concerns, even to the extent of ensuring your business logic components are not dependant on the choice of transport, or even whether you have a transport at all.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_do_we_right_size_microservices">How do we right size microservices?</h3>
<div class="paragraph">
<p>The business component in your system are;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the smallest deployable unit of code and data.</p>
</li>
<li>
<p>functionality which could makes sense to a business user based on your requirements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The right size for your components can depend on why you chose microservices.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>is it to scale the development effort, allowing each developer to work as independently as possible. (Developer efficiency)</p>
</li>
<li>
<p>is it to scale the utilisation of the hardware, allowing each CPU or server to work as independently as possible. (Computer efficiency)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Often we want some of each where the number of components under development is likely to be a function of the number of developers and the number of deployed instances of those components is likely to be a function of the number of CPU or servers.</p>
</div>
<div class="paragraph">
<p>Unless you know performance is a key concern, I would make sure that you prioritise developer efficiency. I would expect for most projects to have around one to three business components per developer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_do_we_deploy_our_components">How do we deploy our components?</h3>
<div class="paragraph">
<p>A microservice is a business component with the option of a transport.  I believe having an optional transport is an important consideration because the business component shouldn&#8217;t be influenced too heavily by the choice of transport and not having a transport can be helpful at different stages of the project.</p>
</div>
<div class="paragraph">
<p>When you are writing unit tests and debugging your business component, you shouldn&#8217;t need to have a transport involved.  If you want to see how two components interact you should be able to create a simple program which creates two or more compoenents, run from your IDE and see how they work together in the same thread.</p>
</div>
<div class="sect3">
<h4 id="_levels_of_distribution">Levels of distribution</h4>
<div class="paragraph">
<p>There is different levels of distribution you want to consider.  Initially you might want no transport at all, provided you ensure these component can be distributed.  Later you need either fine grain or course grained distribution, but over time as the component matures you don&#8217;t need the overhead of managing lots of services and you want the ability to consolidate them.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instances are in same logical task and are wired together with no layer between them.</p>
</li>
<li>
<p>Instances are in separate logical tasks, but share the same thread pool <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>.</p>
</li>
<li>
<p>Instances are in separate thread pool, but in the same process.</p>
</li>
<li>
<p>Instances are in separate OSes, but in the same physical machine.</p>
</li>
<li>
<p>Instances are in the same data centre, but different machines.</p>
</li>
<li>
<p>Instances are in different data centres.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For performance, I favour #1, #2 &amp; #3, for testing and development I favour #1 and #3 and for High Availability you need either #5 and #6.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t need to distriibute instances across machines for HA, you want your instances to be no more seperate than needed.  The degree of separation desirable can change over time.  When a component is being added to production initially, it can be useful to be able to deploy, upgrade and restart that component without impacting the rest of the system.  However as the component stablises and is not changing so much you may want to reduce the overhead of managing this service and include it in a process which has multiple services.  You might find the service uses a trivial amount of CPU and you can combine it into the same thread pool as other services. If it turns out it&#8217;s interaction with another instance is highly coupled you might wire them together as a single component.</p>
</div>
</div>
<div class="sect3">
<h4 id="_migrating_to_microservices">Migrating to Microservices</h4>
<div class="paragraph">
<p>Say you have a monolith, how do you migrate to using microservices?  Do you have to re-engineer your entire solution? NO. Migrating is easier than it sounds as the main advantage for microservices is in the early stages of development when you are putting a service into production.  Anything which is running well in your monolith, leave it there.  Anything you need to add or make major changes to, move it into it&#8217;s own service while it&#8217;s under development and maturing.  You can imagine this as one monolith, planet sized microservice and a number of smaller satelite micro-services surrounding it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_flexable_design">Flexable Design</h3>
<div class="paragraph">
<p>You want your developers to work efficiently and your system to make good utilisation of your servers.  You don&#8217;t want the choices you made at the start to bind you into a solution you will regret later.  If you use a flexable design, you can maximise productivity, and ensure you use microservices to the extend they are helping you, but without the disadvantages of over using this technique.</p>
</div>
</div>
<div class="sect2">
<h3 id="_further_reading">Further reading</h3>
<div class="paragraph">
<p>To read more see my other posts about <a href="https://vanilla-java.github.io/tag/Microservices/">Microservices</a></p>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. a thread pool might have one thread
</div>
</div>
        </div>

        <menu>
            <a href="" id="btn_share" class="btn" title="Share">
                <span aria-hidden="true" data-icon="S"></span>
                <strong>Share</strong>
            </a>
            <a href="http://twitter.com/share?text=Goldilocks%20Microservices&url=https://vanilla-java.github.io/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" id="btn_comment" class="btn" target="_blank">
                <span aria-hidden="true" data-icon="C"></span> Comment on Twitter
            </a>
        </menu>


        <footer class="post-footer" role="contentinfo">

            <div class="vcard">
                <a href="https://vanilla-java.github.io/rss" id="btn_feed" class="btn" title="Feed" target="_blank">
                    <span aria-hidden="true" data-icon=")"></span>
                    <strong>Feed</strong>
                </a>

                <a href="https://vanilla-java.github.io/author/peter-lawrey/" class="photo">
                    <span style="background-image: url('https://avatars0.githubusercontent.com/u/1070321?v&#x3D;4');">
                        <img src="https://avatars0.githubusercontent.com/u/1070321?v&#x3D;4" alt="Peter Lawrey">
                    </span>
                </a>

                <div class="details">
                    <h4><a href="https://vanilla-java.github.io/author/peter-lawrey/" class="url n">Peter Lawrey</a></h4>
                    London<br>
                    <a href="http://vanillajava.blogspot.com/" class="js-remove-domain-schema">http://vanillajava.blogspot.com/</a>
                </div>
            </div>

            <div id="user_bio">
                <div class="inner">
                    Most answers for Java and JVM on StackOverflow.com (~13K), &quot;Vanilla Java&quot; blog with four million views, founder of the Performance JUG,  Java Champion
                </div>
            </div>

        </footer>




    <section class="post-comments">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
      var disqus_shortname = 'vanillajava'; // required: replace example with your forum shortname
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </section>


    </article>

    <div id="share_modal">
        <div class="wrap">
            <div class="inner">
                <header>
                    Share
                    <a href="" class="close" title="Close">&times;</a>
                </header>

                <div class="roon-share-links">
                    <a href="https://twitter.com/share" class="twitter-share-button" data-dnt="true">Tweet</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

                    <div id="fb-elems">
                        <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                        var js, fjs = d.getElementsByTagName(s)[0];
                        if (d.getElementById(id)) return;
                        js = d.createElement(s); js.id = id;
                        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=463438580397968";
                        fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));</script>
                        <div class="fb-like" data-send="false" data-layout="button_count" data-width="110" data-show-faces="false" data-font="arial"></div>
                    </div>

                    <div id="pinit-btn">
                        <a href="//pinterest.com/pin/create/button/?url=https://vanilla-java.github.io/&amp;description=Goldilocks%20Microservices-Vanilla%20Java " data-pin-do="buttonPin" data-pin-config="beside"><img src="//assets.pinterest.com/images/pidgets/pin_it_button.png"></a>
                        <script type="text/javascript" src="//assets.pinterest.com/js/pinit.js"></script>
                    </div>
                </div>
            </div>
        </div>
    </div>




        <a href="https://vanilla-java.github.io" id="blog_badge">
            <span style="background-image: url('https://raw.githubusercontent.com/Vanilla-Java/vanilla-java.github.io/master/images/French-Vanilla-Java.jpg');">Vanilla Java</span>
        </a>


    <script>

            function get_text(el) {
                ret = "";
                var length = el.childNodes.length;
                for(var i = 0; i < length; i++) {
                    var node = el.childNodes[i];
                    if(node.nodeType != 8) {
                        ret += node.nodeType != 1 ? node.nodeValue : get_text(node);
                    }
                }
                return ret;
            }
            function reading_time () {
                var post_content = document.getElementById('js-post-content');
                if (post_content) {
                    var words = get_text(post_content),
                        count = words.split(/\s+/).length,
                        read_time = Math.ceil((count / 150)),
                        read_time_node = document.createTextNode(read_time + ' min read');
                    document.getElementById('js-reading-time').appendChild(read_time_node);
                }
            }

        function no_schema_links () {
            var links = document.querySelectorAll('.js-remove-domain-schema');
            if (links) {
                for (i = 0; i < links.length; ++i) {
                    var link = links[i],
                        text = link.innerHTML,
                        no_schema = text.replace(/.*?:\/\//g, "");
                    link.innerHTML = no_schema;
                }
            }
        }

        window.onload = function () {
            no_schema_links();

            reading_time();
        }
    </script>


    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/prism.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        // hljs.initHighlightingOnLoad();
      </script>

        <script>
            $(function(){
                var share_modal = $("#share_modal"),
                    update_social_links = true;

                $("#btn_share").click(function(){
                    var that = $(this);
                    share_modal.fadeIn(200);
                    return false;
                });

                share_modal.click(function(e){
                    if (e.target.className == "wrap" || e.target.id == "share_modal") {
                        share_modal.fadeOut(200);
                    }
                    return false;
                });

                share_modal.find("div.inner > header > a.close").click(function(){
                    share_modal.fadeOut(200);
                    return false;
                });
            });
        </script>


    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-81039510-1', 'auto');
    ga('send', 'pageview');

    </script>

</body>
</html>
